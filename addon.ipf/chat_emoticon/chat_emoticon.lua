function CHAT_EMOTICON_ON_INIT(addon, frame)	addon:RegisterOpenOnlyMsg('ADD_CHAT_EMOTICON', 'CHAT_EMOTICON_MAKELIST');endfunction CHAT_EMOTICON_OPEN(frame)	CHAT_EMOTICON_MAKELIST(frame);	frame:RunUpdateScript("_CHAT_EMOTICON_UPDATE", 0.001);	  local chatframe = ui.GetFrame('chat');	frame:SetMargin(chatframe:GetX() + 35,chatframe:GetY() - 150,0,0)endfunction _CHAT_EMOTICON_UPDATE(frame, ctrl)	if 1 == keyboard.IsKeyPressed("ESCAPE") then		frame:ShowWindow(0);		end		if keyboard.IsKeyDown("ENTER") == 1 or keyboard.IsKeyDown("PADENTER") == 1 then		frame:ShowWindow(0);		end	return 1;endfunction CHAT_EMOTICON_MAKELIST(frame)	local emoticons = GET_CHILD(frame, "emoticons", "ui::CSlotSet");	local cnt = emoticons:GetSlotCount();	local etc = GetMyEtcObject();	local index = 0;	local list, listCnt = GetClassList("chat_emoticons");	for i = 0 , listCnt - 1 do		local slot = emoticons:GetSlotByIndex(index);		slot:SetOverSound("button_over")		slot:SetClickSound("button_click_chat")		if index < cnt then			local cls = GetClassByIndexFromList(list, i);			if cls.CheckServer == 'YES' then				-- check session emoticons				local haveEmoticon = TryGetProp(etc, 'HaveEmoticon_' .. cls.ClassID);				if haveEmoticon > 0 then					local icon = CreateIcon(slot);					icon:SetImage(cls.ClassName);					index = index + 1;				end			else				local icon = CreateIcon(slot);				icon:SetImage(cls.ClassName);				index = index + 1;			end		end	endendfunction CHAT_EMOTICON_SELECT(frame, ctrl)	if ctrl:GetClassName() == "slot" then		local slot = tolua.cast(ctrl, "ui::CSlot");		local icon = slot:GetIcon();		local imageName = icon:GetInfo().imageName;		CHAT_ADD_EMOTICON(imageName)	endendfunction CHAT_ADD_EMOTICON(imageName)	local chatFrame = GET_CHATFRAME();	local editCtrl = GET_CHILD(chatFrame, "mainchat", "ui::CEditControl");	local curLinkCount = editCtrl:GetLinkCount();	if curLinkCount >= 3 then		ui.MsgBox(ScpArgMsg("Auto_LingKeuui_KaeSuNeun_3KaeLeul_Neomeul_Su_eopSeupNiDa."));		return;	end	local imgheight = 30;	local imgtag =  string.format("{img %s %d %d}{/}", imageName, imgheight, imgheight);			local left = editCtrl:GetCursurLeftText();	local right = editCtrl:GetCursurRightText();	local resultText = string.format("%s%s%s", left, imgtag, right);	SET_CHAT_TEXT(resultText);end